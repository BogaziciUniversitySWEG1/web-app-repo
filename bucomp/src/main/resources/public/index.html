<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.google.com/2005/gml/b"
      xmlns:data="http://www.google.com/2005/gml/data" xmlns:expr="http://www.google.com/2005/gml/expr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="styles/css/cssdemo.css" media="all" rel="stylesheet" type="text/css" />
    <link href="styles/css/font-awesome.css" rel="stylesheet" />
    <title>BuComp</title>
    <link type="text/css" rel="stylesheet" href="styles/css/4235914959-widget_css_bundle.css" />
    <link type="text/css" rel="stylesheet" href="styles/css/authorization.css" />
    <link href="styles/css/Site.css" rel="stylesheet" type="text/css" />
    <link href="styles/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="CommonScripts/jeasyui/themes/color.css" rel="stylesheet" type="text/css" />
    <link href="CommonScripts/jeasyui/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="CommonScripts/jeasyui/themes/default/dialog.css" rel="stylesheet" type="text/css" />
    <link href="CommonScripts/jeasyui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <script src="CommonScripts/jquery.min.js" type="text/javascript"></script>
    <script src="CommonScripts/jeasyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="CommonScripts/Common.js" type="text/javascript"></script>
    <script src="CommonScripts/navigation.js" type="text/javascript"></script>
    <script src="CommonScripts/sweetalert-master/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="CommonScripts/sweetalert-master/dist/sweetalert.css">
    
</head>
<body class="home blog right-sidebar">
    <div id="bpagewrap">
        <header class="site-header" id="masthead" role="banner"></header>
        <!-- #masthead -->
        <div class="panel" id="search-toggle-nav" style="display: block;"></div>
        <div class="bwrapsite-content" id="bwrapcontent">
            <div class="content-area" id="primarybwrap">
                <div class="bwrapsite-main" id="mainbwrap" role="main">
                    <div class="mainblogsec section" id="mainblogsec">
                        <div class="widget Blog" id="Blog1">
                            <div class="blog-posts hfeed" id="communityler">
                            <p align="center" id="loading" style="font-size: large;">
        <img src="images/spinner.gif">
      </p>
                            </div>
                            <div style="clear: both;">
                            </div>
                            <div class="blog-pager" id="blog-pager">
                                <span id="blog-pager-older-link">
                                    <a class="blog-pager-older-link" onClick="FillMoreCommunities();"
                                       id="Blog1_blog-pager-older-link" style="cursor: pointer" title="See More">See More&nbsp;→</a>
                                </span>
<!--                                 <a class="home-link" href="index.html">Home</a> -->
                            </div>
                            <div class="clear">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- #main -->
            </div>
            <!-- #primary -->
            <div class="bwrapwidget-area" id="secondarybwrap" role="complementary">
                <div class="sidebarbtop section" id="sidebarbtop">
                    <div class="widget Label" id="Div2">
                        <h2>
                            <span id="lblCommunityCount"></span>
                            Communities found 
                        </h2>
                    </div>
                    
                    <div class="widget HTML" id="HTML42">
                        <div class="search-wrapper">
                            <label>
                                <span class="screen-reader-text">Search for:</span>
                                <input class="search-field" id = "searchByGroupName" iname="q" placeholder="Search by Group Name" type="search" value="" />
                            </label>
                            <div class="togglenbtclass active" id="search-toggle-2" title="Search" style="float: right;" onclick="DESIGN.SearchCommunity();">
                                
                            </div>
                        </div>
                        <div class="clear">
                        </div>
                        <div class="clear">
                        </div>
                        <br></br>
                        <h2> Sort By</h2>
                        <div class="item-title">
                            <a onClick="GetCommunitiesByTitle();" style="cursor: pointer">Title</a>
                        </div>
                        <div class="item-title">
                            <a onClick="GetCommunitiesByCreationDate();" style="cursor: pointer">Creation Date</a>
                        </div>
                        <div class="item-title">
                            <a style="cursor: pointer">Member Count</a>
                        </div>
                    </div>
                    <div class="widget Label" id="Label1">
                        <h2>
                            Popular Group Tags
                        </h2>
                        <div class="widget-content list-label-widget-content">
                            <ul id="popularTags"></ul>
                            <div class="clear">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- #secondary -->
        </div>
        <!-- #content -->
        <div class="secondary-navigation">
            <div class="menu-footer-container">
                <div class="nbttopmenutop section" id="nbttopmenutop">
                    <div class="widget LinkList" id="LinkList7">
                        <div class="widget-content">
                            <div class="clear">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="site-footer" id="colophon" role="contentinfo">
            <div class="site-info">
                Copyright ©
                <script type="text/javascript">
                    var creditsyear = new Date();
                    document.write(creditsyear.getFullYear());
                </script>
                <a href="index.html">BuComp</a>
            </div><!-- .site-info -->
        </footer>
        <!-- #colophon -->
    </div>
    <!-- #page -->
    <script type="text/javascript">
        //<![CDATA[

        jQuery(document).ready(function ($) {
            function GetContent(){
                DESIGN.GetCommunities(FillCommunities,ErrorFnc);
            }
            
            function FillCommunities(data){
                var communityCounter = 4;
                $("#lblCommunityCount").html(data.length);
                if(data.length < 4){
                    communityCounter = data.length;
                }
                GLOBALS.communityCount = communityCounter;
                GLOBALS.Communities = data;
                for(var i = 0; i< communityCounter; i++){
                    var title = data[i].title;
                    var description = data[i].description.substring(0,200);
                    description = description + "...";
                    var membercount = data[i].memberCount;
                    
                    var tags = "";
                    for(var j = 0; j < data[i].tagsList.length; j++) {
                        var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                        tags = tags + tagItem;
                        if(j < data[i].tagsList.length - 1) {
                            tags = tags + ", ";
                        }
                    }
                    
                    var d = new Date(data[i].creationDate);
                    var creationDateString = "Created on: " + GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                        + " "+ d.getDate() + ", " + d.getFullYear();
                    
                    var communitydetailpage = "community.html?cid=" + data[i].communityId;
                    var uid = GetQueryStringValue("uid");
                    if(uid != "") {
                        communitydetailpage = communitydetailpage + "&uid=" + uid;
                    }
                    
                    
                    var joinButton = '<a style="cursor: pointer" class="nbtjoin-link" onclick="JoinCommunity(' + data[i].communityId + ',' + data[i].joinType + ');">Join</a>';
                    for(var j=0; j < data[i].memberList.length; j++) {
                        if(uid == data[i].memberList[j]) {
                            joinButton = "";
                        }
                    }
                    $("#loading").hide();
                    
                    $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'
                            + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'
                                        +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'
                                        	+communitydetailpage
                                        			+'">'
                                        +title
                                        +'</a>'
                                   +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'
                                       +'<div id="summary4682800689275728420"><div>'
                                       +description
                                       +'</div></div>'
                 +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                +' <a class="nbtmore-link" href="'
                	+communitydetailpage
                			+'">Community Details</a></div>'
                  +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                                + joinButton
                             +'</div><div style="clear: both;"></div></div><footer class="nbtentry-meta">'
                    +'<span class="nbtpost-date">'
                        + creationDateString
                    +'</span><span class="nbtbyline"><span><a '
                    			+'rel="author" title="author profile">'
                    +membercount
                    +' Participants</a></span></span><span class="nbttags-links">'
                    + tags
                    +'</span>'
                                        +'</footer></article><div style="clear: both;"></div></div></div></div>'	
                    		
                    );
                }
                
                DESIGN.GetPopularTags();
            }
            
            function ErrorFnc(){
                alert("An error has occured.");
            }
            
            $(window).on('load', GetContent);
            //DESIGN ilk fonksiyon buradan çağır
        });
        
        function JoinCommunity(communityId,joinType) {
            var uid = GetQueryStringValue("uid");
            if(uid == "") {
            	swal("Please login to join this community!");
            } else {
                if(joinType == 2) {
                    DESIGN.JoinCommunity(communityId);
                } else {
                    DESIGN.ShowRequestModal(communityId);
                }
            }
            
        }
        
        
        function FillMoreCommunities(){
        	var data = GLOBALS.Communities;
        	var startOffset = GLOBALS.communityCount;
        	if (data.length <= GLOBALS.communityCount) {
        		swal("No more community!");
        		return;
        	}
        	
            var communityCounter = 4 + GLOBALS.communityCount;
            if(data.length - GLOBALS.communityCount < 4){
                communityCounter = data.length;
            }
            GLOBALS.communityCount = communityCounter;
            
            for(var i = startOffset; i< communityCounter; i++){
                var title = data[i].title;
                var description = data[i].description.substring(0,200);
                description = description + "...";
                var membercount = data[i].memberCount;
                
                var tags = "";
                for(var j = 0; j < data[i].tagsList.length; j++) {
                    var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                    tags = tags + tagItem;
                    if(j < data[i].tagsList.length - 1) {
                        tags = tags + ", ";
                    }
                }
                
                var d = new Date(data[i].creationDate);
                var creationDateString = "Created on: " + GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                    + " "+ d.getDate() + ", " + d.getFullYear();
                
                var uid = GetQueryStringValue("uid");
                var communitydetailpage = "community.html?cid=" + data[i].communityId + "&uid=" + uid;
                
                var joinButton = '<a style="cursor: pointer" class="nbtjoin-link" onclick="JoinCommunity(' + data[i].communityId + ',' + data[i].joinType + ');">Join</a>';
                for(var j=0; j < data[i].memberList.length; j++) {
                    if(uid == data[i].memberList[j]) {
                        joinButton = "";
                    }
                }
                
                $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'
                        + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'
                                    +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'
                                    	+communitydetailpage
                                    			+'">'
                                    +title
                                    +'</a>'
                               +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'
                                   +'<div id="summary4682800689275728420"><div>'
                                   +description
                                   +'</div></div>'
             +'<div style="float:right;padding-right:10px;margin-top:10px;">'
            +' <a class="nbtmore-link" href="'
            	+communitydetailpage
            			+'">Community Details</a></div>'
              +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                            + joinButton
                         +'</div><div style="clear: both;"></div></div><footer class="nbtentry-meta">'
                +'<span class="nbtpost-date">'
                    + creationDateString
                +'</span><span class="nbtbyline"><span><a '
                			+'rel="author" title="author profile">'
                +membercount
                +' Participants</a></span></span><span class="nbttags-links">'
                + tags
                +'</span>'
                                    +'</footer></article><div style="clear: both;"></div></div></div></div>'	
                		
                );
            }
        }
        
        function GetCommunitiesByTitle(){
        	$("#communityler").html("");
        	$("#communityler").append('<p align="center" id="loading" style="font-size: large;">'
                    +'<img src="images/spinner.gif">'
                    +'</p>');
             DESIGN.GetCommunitiesByTitle(SortCommunities,ErrorFnc);
        }
        
        function GetCommunitiesByCreationDate(){
        	$("#communityler").html("");
        	$("#communityler").append('<p align="center" id="loading" style="font-size: large;">'
                    +'<img src="images/spinner.gif">'
                    +'</p>');
            DESIGN.GetCommunitiesByCreationDate(SortCommunities,ErrorFnc);
        }
        
        function SortCommunities(data){
        	GLOBALS.Communities = data;
        	var communityCounter = GLOBALS.communityCount;
            
            for(var i = 0; i< communityCounter; i++){
                var title = data[i].title;
                var description = data[i].description.substring(0,200);
                description = description + "...";
                var membercount = data[i].memberCount;
                
                var tags = "";
                for(var j = 0; j < data[i].tagsList.length; j++) {
                    var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                    tags = tags + tagItem;
                    if(j < data[i].tagsList.length - 1) {
                        tags = tags + ", ";
                    }
                }
                
                var d = new Date(data[i].creationDate);
                var creationDateString = "Created on: " + GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                    + " "+ d.getDate() + ", " + d.getFullYear();
                
                var uid = GetQueryStringValue("uid");
                var communitydetailpage = "community.html?cid=" + data[i].communityId + "&uid=" + uid;
                
                var joinButton = '<a style="cursor: pointer" class="nbtjoin-link" onclick="JoinCommunity(' + data[i].communityId + ',' + data[i].joinType + ');">Join</a>';
                for(var j=0; j < data[i].memberList.length; j++) {
                    if(uid == data[i].memberList[j]) {
                        joinButton = "";
                    }
                }
                
                $("#loading").hide();
                
                $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'
                        + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'
                                    +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'
                                    	+communitydetailpage
                                    			+'">'
                                    +title
                                    +'</a>'
                               +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'
                                   +'<div id="summary4682800689275728420"><div>'
                                   +description
                                   +'</div></div>'
             +'<div style="float:right;padding-right:10px;margin-top:10px;">'
            +' <a class="nbtmore-link" href="'
            	+communitydetailpage
            			+'">Community Details</a></div>'
              +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                            + joinButton
                         +'</div><div style="clear: both;"></div></div><footer class="nbtentry-meta">'
                +'<span class="nbtpost-date">'
                    + creationDateString
                +'</span><span class="nbtbyline"><span><a '
                			+'rel="author" title="author profile">'
                +membercount
                +' Participants</a></span></span><span class="nbttags-links">'
                + tags
                +'</span>'
                                    +'</footer></article><div style="clear: both;"></div></div></div></div>'	
                		
                );
            }
        	
        }
        
        function ErrorFnc(){
            alert("An error has occured.");
        }

        //]]>
    </script>
    <script src="PageScript/index/GLOBALS.js" type="text/javascript"></script>
    <script src="CommonScripts/GUI_HELPER.js" type="text/javascript"></script>
    <script src="PageScript/index/SP_BANK.js" type="text/javascript"></script>
    <script src="PageScript/index/DESIGN.js" type="text/javascript"></script>
    
    <div id="divRequest" style="display:none;">
        <div class="post-body entry-content">
            <div class="form-group">
                <label for="txtExplanation">Joining to the community requires approval of the administrator. You can type your explanation.</label>
            </div>
            <div class="form-group">
                <label for="txtExplanation">Explanation</label>
                <textarea id="txtExplanation" cols="100" rows="10"></textarea>
            </div>
            <div class="form-group">
                <input type="button" value="Send Request" class="search-submit" onclick="DESIGN.SendJoinRequest();" />
                <input type="button" value="Cancel" class="search-submit" onclick="DESIGN.CancelJoinRequest();" />
            </div>
        </div>
    </div>
    
    <span id="spnCommunityId" style="display:none;"></span>
</body>
</html>
