<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.google.com/2005/gml/b"
      xmlns:data="http://www.google.com/2005/gml/data" xmlns:expr="http://www.google.com/2005/gml/expr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="styles/css/cssdemo.css" media="all" rel="stylesheet" type="text/css" />
    <link href="styles/css/font-awesome.css" rel="stylesheet" />
    <title>BuComp</title>
    <link type="text/css" rel="stylesheet" href="styles/css/4235914959-widget_css_bundle.css" />
    <link type="text/css" rel="stylesheet" href="styles/css/authorization.css" />
    <link href="styles/css/Site.css" rel="stylesheet" type="text/css" />
    <link href="styles/css/layout.css" rel="stylesheet" type="text/css" />
    <script src="CommonScripts/jquery.min.js" type="text/javascript"></script>
    <script src="CommonScripts/Common.js" type="text/javascript"></script>
    <script src="CommonScripts/jeasyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="CommonScripts/navigation.js" type="text/javascript"></script>
    <script src="CommonScripts/sweetalert-master/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="CommonScripts/sweetalert-master/dist/sweetalert.css">
</head>
<body class="home blog right-sidebar">
    <div id="bpagewrap">
        <header class="site-header" id="masthead" role="banner"></header>
        <!-- #masthead -->
        <div class="panel" id="search-toggle-nav" style="display: block;"></div>
        <div class="bwrapsite-content" id="bwrapcontent">
            <div class="content-area" id="primarybwrap">
                <div class="bwrapsite-main" id="mainbwrap" role="main">
                    <div class="mainblogsec section" id="mainblogsec">
                        <div class="widget Blog" id="Blog1">
                            <div class="blog-posts hfeed" >
                            
                                <h2 align="center" id="headerDiv">MY COMMUNITIES</h2>
                                 <h4 align="center" id="headeralertDiv"></h4>
                                 
                                 <br></br>
                                <div id="communityler">
                                <p align="center" id="loading" style="font-size: large;">
        <img src="images/spinner.gif">
      </p>
                                </div>
                                </div>
                            <div style="clear: both;">
                            </div>
                            <div class="blog-pager" id="blog-pager">
                                <span id="blog-pager-older-link">
                                    <a class="blog-pager-older-link" onClick="FillMoreCommunities();" style="cursor: pointer" 
                                       id="seemorelink" title="See More">See More&nbsp;→</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- #main -->
            </div>
            <!-- #primary -->
            <div class="bwrapwidget-area" id="secondarybwrap" role="complementary">
                <div class="sidebarbtop section" id="sidebarbtop">
                <div class="widget Label" id="Div1">

                        <input id="btnCreateCommunity" class="search-submit" type="button" value="Create Community" onclick="NavigateToCommunity();" />
                    </div>
                    <div class="widget Label" id="Div2">
                        <h2>
                            <span id="lblCommunityCount"></span>
                            Communities found
                        </h2>
                    </div>
                    <div class="widget HTML" id="HTML42">
                        <div class="search-wrapper">
                            <label>
                                <span class="screen-reader-text">Search for:</span>
                                <input class="search-field" id="searchByCommunityName" placeholder="Search by Community Name" type="search" value="" />
                            </label>
                            <div class="togglenbtclass active" id="search-toggle-2" title="Search" style="float: right;" onclick="alert (this);">
                            </div>
                        </div>
                        <div class="clear">
                        </div>
                        <div class="clear">
                        </div>
                        <br></br>
                        <h2> Sort By</h2>
                        <div class="item-title">
                            <a onClick="GetCommunitiesByTitle();" style="cursor: pointer">Title</a>
                        </div>
                        <div class="item-title">
                            <a onClick="GetCommunitiesByCreationDate();" style="cursor: pointer">Creation Date</a>
                        </div>
                        <div class="item-title">
                            <a onClick="GetCommunitiesByMemberCount();" style="cursor: pointer">Member Count</a>
                        </div>
                    </div>
                    <div class="widget Label" id="Label1">
                        <h2>
                            Popular Community Tags
                        </h2>
                        <div class="widget-content list-label-widget-content">
                            <ul id="popularTags"></ul>
                            <div class="clear">
                            </div>
                        </div>
                    </div>

                    

                </div>
            </div>
            <!-- #secondary -->
        </div>
        <!-- #content -->
        <div class="secondary-navigation">
            <div class="menu-footer-container">
                <div class="nbttopmenutop section" id="nbttopmenutop">
                    <div class="widget LinkList" id="LinkList7">
                        <div class="widget-content">
                            <div class="clear">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="site-footer" id="colophon" role="contentinfo">
            <div class="site-info">
                Copyright ©
                <script type="text/javascript">
                    var creditsyear = new Date();
                    document.write(creditsyear.getFullYear());
                </script>
                <a href="index.html">BuComp</a>
            </div><!-- .site-info -->
        </footer>
        <!-- #colophon -->
    </div>
    <!-- #page -->
    <script src="CommonScripts/GUI_HELPER.js" type="text/javascript"></script>
    <script src="PageScript/dashboard/GLOBALS.js" type="text/javascript"></script>
    <script src="PageScript/dashboard/SP_BANK.js" type="text/javascript"></script>
    <script src="PageScript/dashboard/DESIGN.js" type="text/javascript"></script>
    <script type="text/javascript">
        //<![CDATA[

        jQuery(document).ready(function ($) {
            function GetContent(){
                var userId = GetQueryStringValue("uid");
                DESIGN.GetCommunitiesByUserId(userId,FillCommunities,ErrorFnc);
            }
            
            function FillCommunities(data){
            	$("#loading").hide();
            	GLOBALS.Communities = data;
            	if(data == null) {
            		document.getElementById('headeralertDiv').innerHTML="You are not member of any community yet. You can use Create Community button to create one or join to an existing community.";
            		document.getElementById('seemorelink').style.display="none";
            		document.getElementById('headerDiv').style.display="none";
            		$("#popularTags").html("No Communities");
            		$("#lblCommunityCount").html(0);
            		return;
            	}
                document.getElementById('headeralertDiv').style.display="none";
                var userId = GetQueryStringValue("uid");
            	
                var communityCounter = 4;
                
                var comcnt = "0";
                if(data != null) {
                	comcnt = data.length;
                }
                $("#lblCommunityCount").html(comcnt);
                if(data.length < 4){
                    communityCounter = data.length;
                }
                GLOBALS.communityCount = communityCounter;
                
                for(var i = 0; i< communityCounter; i++){
                    //var nameSurname = data.communitymembers[i].user.name + " " + data.communitymembers[i].user.surname;
                    //var photoLink = "photos/" + data.communitymembers[i].user.photoLink;
                    //if(data.communitymembers[i].user.photoLink == null){
                    //    photoLink = "images/man-icon.png";
                    //}
                    var title = data[i].title;

                    var description = data[i].description.substring(0,200);
                    description = description + "...";
                    
                    var d = new Date(data[i].creationDate);
                    var creationDateString = GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                        + " "+ d.getDate() + ", " + d.getFullYear();

                    var membercount = data[i].memberCount;
                    
                    var tags = "";
                    for(var j = 0; j < data[i].tagsList.length; j++) {
                        var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                        tags = tags + tagItem;
                        if(j < data[i].tagsList.length - 1) {
                            tags = tags + ", ";
                        }
                    }

                    var communitydetailpage = "community.html?cid=" + data[i].communityId + "&uid=" + userId;

                    $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'

                            + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'

                                        +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'

                                        	+communitydetailpage
                                        	+'">'

                                        +title

                                        +'</a>'

                                   +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'

                                       +'<div id="summary4682800689275728420"><div>'

                                       +description

                                       +'</div></div>'

                 +'<div style="float:right;padding-right:10px;margin-top:10px;">'

                +' <a class="nbtmore-link" href="'

                	+communitydetailpage

                			+'">Community Details</a></div>'

                    +'<div style="clear: both;"></div></div><footer class="nbtentry-meta">'

                    +'<span class="nbtpost-date">'
                                              
                    + creationDateString

                    +'</span><span class="nbtbyline"><span><a href="'

                    +communitydetailpage

                    			+'" rel="author" title="author profile">'

                    +membercount

                    +' Participants</a></span></span><span class="nbttags-links">'

                    	+ tags

                    						+'</span>'

                                        +'</footer></article><div style="clear: both;"></div></div></div></div>'
                    		
                    		
                    		
                    		
                    		
                    );
                }
                
                DESIGN.GetPopularTags();
            }
            
            function ErrorFnc(){
                alert("An error has occured.");
            }

            $(window).on('load', GetContent);
        });
        
        function FillMoreCommunities(){
        	var data = GLOBALS.Communities;
        	var startOffset = GLOBALS.communityCount;
        	if (data.length <= GLOBALS.communityCount) {
        		swal("No more community!");
        		//GUI_HELPER.ALERT("Info", "No more community!", GUI_HELPER.INFO);
        		return;
        	}
        	
            var communityCounter = 4 + GLOBALS.communityCount;
            if(data.length - GLOBALS.communityCount < 4){
                communityCounter = data.length;
            }
            GLOBALS.communityCount = communityCounter;
            
            for(var i = startOffset; i< communityCounter; i++){
                var title = data[i].title;
                var description = data[i].description.substring(0,200);
                description = description + "...";
                var membercount = data[i].memberCount;
                
                var tags = "";
                for(var j = 0; j < data[i].tagsList.length; j++) {
                    var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                    tags = tags + tagItem;
                    if(j < data[i].tagsList.length - 1) {
                        tags = tags + ", ";
                    }
                }
                
                var d = new Date(data[i].creationDate);
                var creationDateString = "Created on: " + GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                    + " "+ d.getDate() + ", " + d.getFullYear();
                
                var uid = GetQueryStringValue("uid");
                var communitydetailpage = "community.html?cid=" + data[i].communityId + "&uid=" + uid;
                
                var joinButton = '<a style="cursor: pointer" class="nbtjoin-link" onclick="JoinCommunity(' + data[i].communityId + ',' + data[i].joinType + ');">Join</a>';
                for(var j=0; j < data[i].memberList.length; j++) {
                    if(uid == data[i].memberList[j]) {
                        joinButton = "";
                    }
                }
                
                $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'
                        + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'
                                    +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'
                                    	+communitydetailpage
                                    			+'">'
                                    +title
                                    +'</a>'
                               +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'
                                   +'<div id="summary4682800689275728420"><div>'
                                   +description
                                   +'</div></div>'
             +'<div style="float:right;padding-right:10px;margin-top:10px;">'
            +' <a class="nbtmore-link" href="'
            	+communitydetailpage
            			+'">Community Details</a></div>'
              +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                            + joinButton
                         +'</div><div style="clear: both;"></div></div><footer class="nbtentry-meta">'
                +'<span class="nbtpost-date">'
                    + creationDateString
                +'</span><span class="nbtbyline"><span><a '
                			+'rel="author" title="author profile">'
                +membercount
                +' Participants</a></span></span><span class="nbttags-links">'
                + tags
                +'</span>'
                                    +'</footer></article><div style="clear: both;"></div></div></div></div>'	
                		
                );
            }
        }
        
        function GetCommunitiesByTitle(){
        	$("#communityler").html("");
        	$("#communityler").append('<p align="center" id="loading" style="font-size: large;">'
                    +'<img src="images/spinner.gif">'
                    +'</p>');
        	var userId = GetQueryStringValue("uid");
             DESIGN.GetCommunitiesByTitle(userId, SortCommunities,ErrorFnc);
        }
        
        function GetCommunitiesByCreationDate(){
        	$("#communityler").html("");
        	$("#communityler").append('<p align="center" id="loading" style="font-size: large;">'
                    +'<img src="images/spinner.gif">'
                    +'</p>');
        	var userId = GetQueryStringValue("uid");
            DESIGN.GetCommunitiesByCreationDate(userId,SortCommunities,ErrorFnc);
        }
        
        function GetCommunitiesByMemberCount(){
        	$("#communityler").html("");
        	$("#communityler").append('<p align="center" id="loading" style="font-size: large;">'
                    +'<img src="images/spinner.gif">'
                    +'</p>');
        	var userId = GetQueryStringValue("uid");
             DESIGN.GetCommunitiesByMemberCount(userId, SortCommunities,ErrorFnc);
        }
        
        function SortCommunities(data){
        	GLOBALS.Communities = data;
        	var communityCounter = GLOBALS.communityCount;

            $("#loading").hide();
            
            for(var i = 0; i< communityCounter; i++){
                var title = data[i].title;
                var description = data[i].description.substring(0,200);
                description = description + "...";
                var membercount = data[i].memberCount;
                
                var tags = "";
                for(var j = 0; j < data[i].tagsList.length; j++) {
                    var tagItem = "<a rel=\"tag\">" + data[i].tagsList[j].tag + "</a>";
                    tags = tags + tagItem;
                    if(j < data[i].tagsList.length - 1) {
                        tags = tags + ", ";
                    }
                }
                
                var d = new Date(data[i].creationDate);
                var creationDateString = "Created on: " + GUI_HELPER.GetDayName(d.getDay()) + ", " + GUI_HELPER.GetMonthName(d.getMonth()) 
                    + " "+ d.getDate() + ", " + d.getFullYear();
                
                var uid = GetQueryStringValue("uid");
                var communitydetailpage = "community.html?cid=" + data[i].communityId + "&uid=" + uid;
                
                var joinButton = '<a style="cursor: pointer" class="nbtjoin-link" onclick="JoinCommunity(' + data[i].communityId + ',' + data[i].joinType + ');">Join</a>';
                for(var j=0; j < data[i].memberList.length; j++) {
                    if(uid == data[i].memberList[j]) {
                        joinButton = "";
                    }
                }
                
                
                $("#communityler").append('<div class="date-outer"><h2 class="date-header"><span>Sunday, September 5, 2010</span>'
                        + '</h2><div class="date-posts"><div class="post-outer"><article class="post hentry"><a name="4682800689275728420"></a>'
                                    +'<header class="entry-header"><h2 class="post-title entry-title"><a href="'
                                    	+communitydetailpage
                                    			+'">'
                                    +title
                                    +'</a>'
                               +'</h2></header><div class="post-header-line-1"></div><div class="post-body entry-content">'
                                   +'<div id="summary4682800689275728420"><div>'
                                   +description
                                   +'</div></div>'
             +'<div style="float:right;padding-right:10px;margin-top:10px;">'
            +' <a class="nbtmore-link" href="'
            	+communitydetailpage
            			+'">Community Details</a></div>'
              +'<div style="float:right;padding-right:10px;margin-top:10px;">'
                            + joinButton
                         +'</div><div style="clear: both;"></div></div><footer class="nbtentry-meta">'
                +'<span class="nbtpost-date">'
                    + creationDateString
                +'</span><span class="nbtbyline"><span><a '
                			+'rel="author" title="author profile">'
                +membercount
                +' Participants</a></span></span><span class="nbttags-links">'
                + tags
                +'</span>'
                                    +'</footer></article><div style="clear: both;"></div></div></div></div>'	
                		
                );
            }
        	
        }
        
        function NavigateToCommunity(){
            var userId = GetQueryStringValue("uid");
            var link = "createcommunity.html?uid=" + userId;
            window.location = link;
        }
        
        function ErrorFnc(){
        	swal({   title: "Error!",   text: "An error has occurred!",   type: "error",   confirmButtonText: "OK" });
       }

        //]]>
    </script>
    
</body>
</html>
